<div class="categories-container">
  <mat-card class="page-header">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>category</mat-icon>
        Gestión de Categorías
      </mat-card-title>
    </mat-card-header>
    <mat-card-actions *ngIf="isLoggedIn()">
      <button matButton="filled" color="primary" routerLink="/admin/categories/new">
        <mat-icon>add</mat-icon>
        Nueva Categoría
      </button>
    </mat-card-actions>
  </mat-card>

  <mat-card *ngIf="loading" class="loading-card">
    <mat-card-content>
      <div class="loading-content">
        <mat-spinner diameter="40"></mat-spinner>
        <p>Cargando categorías...</p>
      </div>
    </mat-card-content>
  </mat-card>

  <mat-card *ngIf="error" class="error-card">
    <mat-card-content>
      <div class="error-content">
        <mat-icon color="warn">error</mat-icon>
        <p>{{ error }}</p>
        <button mat-raised-button color="accent" (click)="loadCategories()">
          <mat-icon>refresh</mat-icon>
          Reintentar
        </button>
      </div>
    </mat-card-content>
  </mat-card>

  <div class="categories-grid" *ngIf="!loading && !error && categories.length > 0">
    <mat-card class="category-card" *ngFor="let category of categories">
      <mat-card-header>
        <mat-card-title>
          <mat-icon *ngIf="category.icon">{{ category.icon }}</mat-icon>
          {{ category.name }}
        </mat-card-title>
        <mat-card-subtitle>
          <div class="status-buttons">
            <button mat-mini-fab 
                    [color]="category.isActive ? 'primary' : 'warn'"
                    class="status-button">
              <mat-icon>{{ category.isActive ? 'check_circle' : 'cancel' }}</mat-icon>
            </button>
            <span class="status-text">{{ category.isActive ? 'Activa' : 'Inactiva' }}</span>
            
            <button mat-mini-fab 
                    color="accent"
                    class="count-button">
              <mat-icon>inventory</mat-icon>
            </button>
            <span class="count-text">{{ getProductTypesCount(category) }} tipos</span>
          </div>
        </mat-card-subtitle>
      </mat-card-header>
      
      <mat-card-content *ngIf="category.description" class="mt-3 mb-2">
        <p>{{ category.description }}</p>
      </mat-card-content>
      
      <mat-card-actions *ngIf="isLoggedIn()" class="category-actions">
        <button mat-button matButton="filled" color="primary" [routerLink]="['/admin/categories/edit', category.id]">
          <mat-icon>edit</mat-icon>
          Editar
        </button>
        <button mat-button matButton="outlined" color="primary" [routerLink]="['/admin/product-types', 'category', category.id]">
          <mat-icon>inventory</mat-icon>
          Ver Tipos
        </button>
        <button mat-button matButton="outlined" color="warn" (click)="deleteCategory(category.id!)">
          <mat-icon>delete</mat-icon>
          Eliminar
        </button>
      </mat-card-actions>
    </mat-card>
  </div>

  <mat-card *ngIf="!loading && !error && categories.length === 0" class="empty-state">
    <mat-card-content>
      <div class="empty-content">
        <mat-icon>folder_open</mat-icon>
        <h3>No hay categorías disponibles</h3>
        <p>Comienza creando tu primera categoría</p>
        <button mat-raised-button color="primary" routerLink="/admin/categories/new" *ngIf="isLoggedIn()">
          <mat-icon>add</mat-icon>
          Crear Primera Categoría
        </button>
      </div>
    </mat-card-content>
  </mat-card>
</div>
