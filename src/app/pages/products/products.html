<div class="products-container">
  <mat-card class="page-header">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>inventory</mat-icon>
        Gesti√≥n de Productos
      </mat-card-title>
    </mat-card-header>
    <mat-card-actions>
      <button 
        mat-raised-button 
        [color]="showActiveOnly ? 'primary' : 'accent'"
        (click)="toggleActiveFilter()"
        class="me-2">
        <mat-icon>{{ showActiveOnly ? 'visibility' : 'visibility_off' }}</mat-icon>
        {{ showActiveOnly ? 'Mostrar Todos' : 'Solo Activos' }}
      </button>
      <button mat-raised-button color="primary" routerLink="/admin/products/new" *ngIf="isLoggedIn()">
        <mat-icon>add</mat-icon>
        Nuevo Producto
      </button>
    </mat-card-actions>
  </mat-card>

  <mat-card *ngIf="loading" class="loading-card">
    <mat-card-content>
      <div class="loading-content">
        <mat-spinner diameter="40"></mat-spinner>
        <p>Cargando productos...</p>
      </div>
    </mat-card-content>
  </mat-card>

  <mat-card *ngIf="error" class="error-card">
    <mat-card-content>
      <div class="error-content">
        <mat-icon color="warn">error</mat-icon>
        <p>{{ error }}</p>
        <button mat-raised-button color="accent" (click)="loadProducts()">
          <mat-icon>refresh</mat-icon>
          Reintentar
        </button>
      </div>
    </mat-card-content>
  </mat-card>

  <div class="products-grid" *ngIf="!loading && !error && products.length > 0">
    <mat-card class="producto-card" *ngFor="let product of products">
      <img mat-card-image
        [src]="product.imageUrl || 'https://i5.walmartimages.com/seo/Funko-POP-Football-Kylian-Mbapp-PSG_26b8cdaf-a999-4e78-904a-fe3930e8926c_1.95fa658cc18ab713bc292e2763d63ee6.png'"
        alt="Imagen del producto">
      <mat-card-title>{{ product.model }}</mat-card-title>
      <mat-card-subtitle *ngIf="product.brand">{{ product.brand }}</mat-card-subtitle>
      <mat-card-content>
        <p *ngIf="product.description">{{ product.description }}</p>
        <div class="product-details" *ngIf="product.price || product.country">
          <p *ngIf="product.price" class="price">
            <mat-icon>euro</mat-icon>
            {{ formatPrice(product.price) }}
          </p>
          <p *ngIf="product.country" class="country">
            <mat-icon>public</mat-icon>
            {{ product.country }}
          </p>
        </div>
        <div class="product-type" *ngIf="product.productType">
          <mat-icon>label</mat-icon>
          <span>{{ product.productType.name }}</span>
        </div>
        <div class="stock-info">
          <mat-icon>inventory_2</mat-icon>
          <span>Stock: {{ product.stock }}</span>
        </div>
        <div class="status-info">
          <mat-icon [color]="product.isActive ? 'primary' : 'warn'">
            {{ product.isActive ? 'check_circle' : 'cancel' }}
          </mat-icon>
          <span [class.active]="product.isActive" [class.inactive]="!product.isActive">
            {{ product.isActive ? 'Activo' : 'Inactivo' }}
          </span>
        </div>
      </mat-card-content>
      <mat-card-actions *ngIf="isLoggedIn()">
        <button mat-raised-button color="primary" [routerLink]="['/admin/products/edit', product.id]">
          <mat-icon>edit</mat-icon>
          Editar
        </button>
        <button mat-stroked-button color="warn" (click)="deleteProduct(product.id!)">
          <mat-icon>delete</mat-icon>
          Eliminar
        </button>
      </mat-card-actions>
    </mat-card>
  </div>

  <mat-card *ngIf="!loading && !error && products.length === 0" class="empty-state">
    <mat-card-content>
      <div class="empty-content">
        <mat-icon>inventory_2</mat-icon>
        <h3>No hay productos disponibles</h3>
        <p>Comienza creando tu primer producto</p>
        <button mat-raised-button color="primary" routerLink="/admin/products/new" *ngIf="isLoggedIn()">
          <mat-icon>add</mat-icon>
          Crear Primer Producto
        </button>
      </div>
    </mat-card-content>
  </mat-card>
</div>
