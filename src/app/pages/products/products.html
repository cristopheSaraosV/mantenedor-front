<div class="products-container">
  <mat-card class="page-header">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>inventory</mat-icon>
        Gesti√≥n de Productos
      </mat-card-title>
    </mat-card-header>
    <mat-card-actions>
      <button 
        mat-raised-button 
        [color]="showActiveOnly ? 'primary' : 'accent'"
        (click)="toggleActiveFilter()"
        class="me-2">
        <mat-icon>{{ showActiveOnly ? 'visibility' : 'visibility_off' }}</mat-icon>
        {{ showActiveOnly ? 'Mostrar Todos' : 'Solo Activos' }}
      </button>
      <button mat-raised-button color="primary" routerLink="/products/new" *ngIf="isLoggedIn()">
        <mat-icon>add</mat-icon>
        Nuevo Producto
      </button>
    </mat-card-actions>
  </mat-card>

  <mat-card *ngIf="loading" class="loading-card">
    <mat-card-content>
      <div class="loading-content">
        <mat-spinner diameter="40"></mat-spinner>
        <p>Cargando productos...</p>
      </div>
    </mat-card-content>
  </mat-card>

  <mat-card *ngIf="error" class="error-card">
    <mat-card-content>
      <div class="error-content">
        <mat-icon color="warn">error</mat-icon>
        <p>{{ error }}</p>
        <button mat-raised-button color="accent" (click)="loadProducts()">
          <mat-icon>refresh</mat-icon>
          Reintentar
        </button>
      </div>
    </mat-card-content>
  </mat-card>

  <div class="products-grid" *ngIf="!loading && !error && products.length > 0">
    <mat-card class="product-card" *ngFor="let product of products">
      <mat-card-header>
        <mat-card-title>{{ product.model }}</mat-card-title>
        <mat-card-subtitle>
          <div class="status-buttons">
            <button mat-mini-fab 
                    [color]="product.isActive ? 'primary' : 'warn'"
                    class="status-button">
              <mat-icon>{{ product.isActive ? 'check_circle' : 'cancel' }}</mat-icon>
            </button>
            <span class="status-text">{{ product.isActive ? 'Activo' : 'Inactivo' }}</span>
            
            <button mat-mini-fab 
                    [color]="product.stock < 10 ? 'warn' : 'primary'"
                    class="count-button">
              <mat-icon>inventory_2</mat-icon>
            </button>
            <span class="count-text">Stock: {{ product.stock }}</span>
          </div>
        </mat-card-subtitle>
      </mat-card-header>
      
      <mat-card-content>
        <div class="product-image" *ngIf="product.imageUrl">
          <img [src]="product.imageUrl" alt="Imagen del producto" class="product-img">
        </div>
        
        <p class="description" *ngIf="product.description">{{ product.description }}</p>
        
        <div class="product-details">
          <div class="detail-row" *ngIf="product.price">
            <mat-icon>euro</mat-icon>
            <span class="price">{{ formatPrice(product.price) }}</span>
          </div>
          <div class="detail-row" *ngIf="product.brand">
            <mat-icon>business</mat-icon>
            <span>{{ product.brand }}</span>
          </div>
          <div class="detail-row" *ngIf="product.country">
            <mat-icon>public</mat-icon>
            <span>{{ product.country }}</span>
          </div>
          <div class="detail-row" *ngIf="product.productType">
            <mat-icon>label</mat-icon>
            <span>{{ product.productType.name }}</span>
          </div>
        </div>
      </mat-card-content>
      
      <mat-card-actions *ngIf="isLoggedIn()" class="product-actions">
        <button mat-button color="primary" [routerLink]="['/products/edit', product.id]">
          <mat-icon>edit</mat-icon>
          Editar
        </button>
        <button mat-button color="warn" (click)="deleteProduct(product.id!)">
          <mat-icon>delete</mat-icon>
          Eliminar
        </button>
      </mat-card-actions>
    </mat-card>
  </div>

  <mat-card *ngIf="!loading && !error && products.length === 0" class="empty-state">
    <mat-card-content>
      <div class="empty-content">
        <mat-icon>inventory_2</mat-icon>
        <h3>No hay productos disponibles</h3>
        <p>Comienza creando tu primer producto</p>
        <button mat-raised-button color="primary" routerLink="/products/new" *ngIf="isLoggedIn()">
          <mat-icon>add</mat-icon>
          Crear Primer Producto
        </button>
      </div>
    </mat-card-content>
  </mat-card>
</div>
