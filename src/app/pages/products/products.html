<div class="container py-4 products-container">

  <!-- ENCABEZADO -->
  <div class="card shadow-sm mb-4 border-0">
    <div class="card-header d-flex justify-content-between align-items-center flex-wrap">

      <div class="d-flex align-items-center gap-2">
        <button
          mat-button matButton="filled" color="primary"
          class="d-flex align-items-center gap-1"
          (click)="toggleActiveFilter()">
          <mat-icon>{{ showActiveOnly ? 'visibility' : 'visibility_off' }}</mat-icon>
          {{ showActiveOnly ? 'Mostrar Todos' : 'Solo Activos' }}
        </button>

        <button
          *ngIf="isLoggedIn()"
          class="btn btn-outline-light btn-sm d-flex align-items-center gap-1"
          routerLink="/admin/products/new">
          <mat-icon>add</mat-icon> Nuevo Producto
        </button>
      </div>
    </div>
  </div>

  <!-- ESTADO: CARGANDO -->
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-primary mb-3" role="status"></div>
    <p>Cargando productos...</p>
  </div>

  <!-- ESTADO: ERROR -->
  <div *ngIf="error" class="alert alert-danger text-center">
    <mat-icon color="warn" class="me-2">error</mat-icon>
    {{ error }}
    <div class="mt-3">
      <button class="btn btn-outline-danger d-inline-flex align-items-center gap-1" (click)="loadProducts()">
        <mat-icon>refresh</mat-icon> Reintentar
      </button>
    </div>
  </div>

  <!-- GRID DE PRODUCTOS -->
  <div class="row g-4" *ngIf="!loading && !error && products.length > 0">
    <div class="col-12 col-md-6 col-lg-4 col-xl-3" *ngFor="let product of products">
      <div class="card h-100 shadow-sm border-0">
        <img
          [src]="product.imageUrl || 'https://i5.walmartimages.com/seo/Funko-POP-Football-Kylian-Mbapp-PSG_26b8cdaf-a999-4e78-904a-fe3930e8926c_1.95fa658cc18ab713bc292e2763d63ee6.png'"
          alt="Imagen del producto"
          class="card-img-top"
        />

        <div class="card-body d-flex flex-column justify-content-between">
          <div>
            <h5 class="card-title fw-bold mb-1">{{ product.model }}</h5>
            <p *ngIf="product.brand" class="card-subtitle text-muted mb-2">{{ product.brand }}</p>

            <p *ngIf="product.description" class="text-secondary small mb-2">{{ product.description }}</p>

            <div class="d-flex align-items-center gap-1 text-success mb-1" *ngIf="product.price">
              <mat-icon>euro</mat-icon>
              <span class="fw-semibold">{{ formatPrice(product.price) }}</span>
            </div>

            <div class="d-flex align-items-center gap-1 text-muted mb-1" *ngIf="product.country">
              <mat-icon>public</mat-icon>
              <span>{{ product.country }}</span>
            </div>

            <div class="d-flex align-items-center gap-1 text-primary mb-1" *ngIf="product.productType">
              <mat-icon>label</mat-icon>
              <span>{{ product.productType.name }}</span>
            </div>

            <div class="d-flex align-items-center gap-1 mb-1">
              <mat-icon>inventory_2</mat-icon>
              <span>Stock: {{ product.stock }}</span>
            </div>

            <div class="d-flex align-items-center gap-1 mt-2">
              <mat-icon [class.text-success]="product.isActive" [class.text-danger]="!product.isActive">
                {{ product.isActive ? 'check_circle' : 'cancel' }}
              </mat-icon>
              <small [class.text-success]="product.isActive" [class.text-danger]="!product.isActive">
                {{ product.isActive ? 'Activo' : 'Inactivo' }}
              </small>
            </div>
          </div>

          <!-- BOTONES -->
          <div *ngIf="isLoggedIn()" class="mt-3 pt-3 border-top d-flex flex-wrap gap-2">
            <button class="btn btn-primary btn-sm d-flex align-items-center gap-1"
                    [routerLink]="['/admin/products/edit', product.id]">
              <mat-icon>edit</mat-icon> Editar
            </button>
            <button class="btn btn-outline-danger btn-sm d-flex align-items-center gap-1"
                    (click)="deleteProduct(product.id!)">
              <mat-icon>delete</mat-icon> Eliminar
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ESTADO: VACÍO -->
  <div *ngIf="!loading && !error && products.length === 0" class="text-center py-5">
    <mat-icon class="fs-1 text-secondary mb-2">inventory_2</mat-icon>
    <h5>No hay productos disponibles</h5>
    <p>Comienza creando tu primer producto</p>
    <button *ngIf="isLoggedIn()" class="btn btn-primary d-inline-flex align-items-center gap-1"
            routerLink="/admin/products/new">
      <mat-icon>add</mat-icon> Crear Primer Producto
    </button>
  </div>
</div>
